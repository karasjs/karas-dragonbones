!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("homunculus")):"function"==typeof define&&define.amd?define(["homunculus"],n):(e=e||self).yurine=n(e.homunculus)}(this,function(t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function a(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,n,t){return n&&a(e.prototype,n),t&&a(e,t),e}var o,i,c=(t=t&&t.hasOwnProperty("default")?t.default:t).getClass("token","js"),l=t.getClass("token","csx"),u=(t.getClass("node","csx"),{});function f(e,n){return i=o="",function n(e,t){if(e instanceof l||e instanceof c){if(e.isVirtual())return;for(e.ignore=!0,i="";(e=e.next())&&!e.isVirtual()&&u.hasOwnProperty(e.type());){var r=e.content();o+=r,i+=r,!t&&"\n"==r||(e.ignore=!0)}}else e.isToken()?n(e.token(),t):e.leaves().forEach(function(e){n(e,t)})}(e,n),{res:o,append:i}}u[l.LINE]=u[l.COMMENT]=u[l.BLANK]=!0,f.S=u;var p=t.getClass("Node","es6"),v=t.getClass("Token");function h(e,n){return function n(e,t){var r=e.name()===p.TOKEN;var a=r&&e.token().type()===v.VIRTUAL;if(r){var s=e.token();a?";"===s.content()&&(t.s+=";",t.word=!1):(t.word&&-1<[v.ID,v.NUMBER,v.KEYWORD].indexOf(s.type())&&(t.s+=" "),"}"===s.content()&&";"===t.s.charAt(t.s.length-1)&&(t.s=t.s.replace(/;$/,"")),t.s+=s.content(),t.word=-1<[v.ID,v.NUMBER,v.KEYWORD].indexOf(s.type()))}else e.leaves().forEach(function(e){n(e,t)});return t}(e,{s:"",word:n}).s}t.getClass("token","csx");var k=t.getClass("node","csx");function g(e,n){var t,r="",a=e.leaf(1);if(a.isToken())t=a.token().content();else if(a.name()===k.CSXMemberExpression){t=a.first().token().content();for(var s=1,o=a.size();s<o;s++)t+=a.leaf(s).token().content()}var i=/^[A-Z]/.test(t);i?(r+="karas.createCp(",r+=t):(/^\$/.test(t)?r+="karas.createGm(":r+="karas.createVd(",r+='"'+t+'"'),r+=",{";for(var c=2,l=e.size();c<l-1;c++){var u=e.leaf(c);switch(2!==c&&(r+=","),u.name()){case k.CSXBindAttribute:case k.CSXAttribute:r+=C(u);break;case k.CSXSpreadAttribute:r+=h(u.leaf(2))}}return r+="}",n&&i&&(r+=',[],"'+t+'"'),{res:r,isCp:i,name:t}}function C(e){var n="";n+='"'+e.first().token().content()+'":';var t=e.last();return t.isToken()?n+=t=t.token().content():n+=m(t),n}function m(e){return(new y).parse(e).replace(/^(\s*){/,"$1").replace(/}(\s*)$/,"$1")}function d(e){var n="";switch(e.name()){case k.CSXElement:n+=function(e){var n="",t=g(e.first());n+=t.res,n+=",[";for(var r=!1,a=1,s=e.size();a<s-1;a++){var o=e.leaf(a);switch(o.name()){case k.CSXChild:r&&(n+=",",r=!1),n+=m(o),r=!0;break;case k.TOKEN:var i=o.token().content();/^\s+$/.test(i)?o.prev().name()===k.CSXOpeningElement&&o.next().name()===k.CSXClosingElement?n+='"'+i.replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n\\\n")+'"':n+=i:(r&&(n+=",",r=!1),n+='"'+i.replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n\\\n")+'"',r=!0);break;default:r&&(n+=",",r=!1),n+=d(o),r=!0}}return n+="]",t.isCp&&t.name&&(n+=',"'+t.name+'"'),n+=")",e.last().name()===k.CSXClosingElement&&(n+=f(e.last(),!0).res),n}(e);break;case k.CSXSelfClosingElement:n+=g(e,!0).res,n+=")";break;case k.CSXFragment:n+=function(e){for(var n="karas.createFg([",t=!1,r=2,a=e.size();r<a-2;r++){var s=e.leaf(r);switch(s.name()){case k.CSXChild:t&&(n+=",",t=!1),n+=m(s),t=!0;break;case k.TOKEN:var o=s.token().content();/^\s+$/.test(o)?s.prev().name()===k.CSXOpeningElement&&s.next().name()===k.CSXClosingElement?n+='"'+o.replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n\\\n")+'"':n+=o:(t&&(n+=",",t=!1),n+='"'+o.replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n\\\n")+'"',t=!0);break;default:t&&(n+=",",t=!1),n+=d(s),t=!0}}return n+="])"}(e)}return n}var E=t.getClass("node","csx"),y=function(){function e(){r(this,e),this.res=""}return s(e,[{key:"parse",value:function(e){return this.recursion(e,!1),this.res}},{key:"recursion",value:function(e){var n=this;if(e.isToken()){var t=e.token();if(t.isVirtual())return;for(t.ignore||(this.res+=t.content());t.next()&&!(t=t.next()).isVirtual()&&f.S.hasOwnProperty(t.type());)t.ignore||(this.res+=t.content())}else{switch(e.name()){case E.CSXElement:case E.CSXSelfClosingElement:case E.CSXFragment:return void(this.res+=d(e))}e.leaves().forEach(function(e){n.recursion(e)})}}}]),e}();return new(function(){function n(){r(this,n),this.parser=null,this.node=null}return s(n,[{key:"parse",value:function(e){return this.parser=t.getParser("csx"),this.node=this.parser.parse(e),(new y).parse(this.node)}},{key:"tokens",value:function(){return this.ast?this.parser.lexer.tokens():null}},{key:"ast",value:function(){return this.node}}],[{key:"parse",value:function(e){return(new n).parse(e)}}]),n}())});
//# sourceMappingURL=index.min.js.map

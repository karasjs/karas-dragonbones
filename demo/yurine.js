!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("homunculus")):"function"==typeof define&&define.amd?define(["homunculus"],n):(e=e||self).yurine=n(e.homunculus)}(this,function(t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,n,t){return n&&s(e.prototype,n),t&&s(e,t),e}var o,i,c=(t=t&&t.hasOwnProperty("default")?t.default:t).getClass("token","js"),u=t.getClass("token","csx"),l=(t.getClass("node","csx"),{});function f(e,n){return i=o="",function n(e,t){if(e instanceof u||e instanceof c){if(e.isVirtual())return;for(e.ignore=!0,i="";(e=e.next())&&!e.isVirtual()&&l.hasOwnProperty(e.type());){var r=e.content();o+=r,i+=r,!t&&"\n"==r||(e.ignore=!0)}}else e.isToken()?n(e.token(),t):e.leaves().forEach(function(e){n(e,t)})}(e,n),{res:o,append:i}}l[u.LINE]=l[u.COMMENT]=l[u.BLANK]=!0,f.S=l;var p=t.getClass("Node","es6"),h=t.getClass("Token");function k(e,n){return function n(e,t){var r=e.name()===p.TOKEN;var s=r&&e.token().type()===h.VIRTUAL;if(r){var a=e.token();s?";"===a.content()&&(t.s+=";",t.word=!1):(t.word&&-1<[h.ID,h.NUMBER,h.KEYWORD].indexOf(a.type())&&(t.s+=" "),"}"===a.content()&&";"===t.s.charAt(t.s.length-1)&&(t.s=t.s.replace(/;$/,"")),t.s+=a.content(),t.word=-1<[h.ID,h.NUMBER,h.KEYWORD].indexOf(a.type()))}else e.leaves().forEach(function(e){n(e,t)});return t}(e,{s:"",word:n}).s}t.getClass("token","csx");var v=t.getClass("node","csx");function d(e){var n,t="",r=e.leaf(1);if(r.isToken())n=r.token().content();else if(r.name()===v.CSXMemberExpression){n=r.first().token().content();for(var s=1,a=r.size();s<a;s++)n+=r.leaf(s).token().content()}/^[A-Z]/.test(n)?(t+="karas.createCp(",t+=n):(/^\$/.test(n)?t+="karas.createGm(":t+="karas.createVd(",t+='"'+n+'"'),t+=",[";for(var o=2,i=e.size();o<i-1;o++){var c=e.leaf(o);switch(2!==o&&(t+=","),c.name()){case v.CSXBindAttribute:case v.CSXAttribute:t+=C(c);break;case v.CSXSpreadAttribute:t+=k(c.leaf(2))}}return t+="]"}function C(e){var n="",t=e.first().token().content(),r=e.parent().leaf(1).token().content();/^[A-Z]/.test(r);n+='["'+t+'"'+",";var s=e.last();return s.isToken()?n+=s=s.token().content():n+=m(s),n+="]"}function m(e){return(new E).parse(e).replace(/^(\s*){/,"$1").replace(/}(\s*)$/,"$1")}function g(e){var n="";switch(e.name()){case v.CSXElement:n+=function(e){var n="";n+=d(e.first()),n+=",[";for(var t=!1,r=1,s=e.size();r<s-1;r++){var a=e.leaf(r);switch(a.name()){case v.CSXChild:t&&(n+=",",t=!1),n+=m(a),t=!0;break;case v.TOKEN:var o=a.token().content();/^\s+$/.test(o)?a.prev().name()===v.CSXOpeningElement&&a.next().name()===v.CSXClosingElement?n+='"'+o.replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n")+'"':n+=o:(t&&(n+=",",t=!1),n+='"'+o.replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n")+'"',t=!0);break;default:t&&(n+=",",t=!1),n+=g(a),t=!0}}return n+="])",e.last().name()===v.CSXClosingElement&&(n+=f(e.last(),!0).res),n}(e);break;case v.CSXSelfClosingElement:n+=d(e),n+=")"}return n}var y=t.getClass("node","csx"),E=function(){function e(){r(this,e),this.res=""}return a(e,[{key:"parse",value:function(e){return this.recursion(e,!1),this.res}},{key:"recursion",value:function(e){var n=this;if(e.isToken()){var t=e.token();if(t.isVirtual())return;for(t.ignore||(this.res+=t.content());t.next()&&!(t=t.next()).isVirtual()&&f.S.hasOwnProperty(t.type());)t.ignore||(this.res+=t.content())}else{switch(e.name()){case y.CSXElement:case y.CSXSelfClosingElement:return void(this.res+=g(e))}e.leaves().forEach(function(e){n.recursion(e)})}}}]),e}();return new(function(){function n(){r(this,n),this.parser=null,this.node=null}return a(n,[{key:"parse",value:function(e){return this.parser=t.getParser("csx"),this.node=this.parser.parse(e),(new E).parse(this.node)}},{key:"tokens",value:function(){return this.ast?this.parser.lexer.tokens():null}},{key:"ast",value:function(){return this.node}}],[{key:"parse",value:function(e){return(new n).parse(e)}}]),n}())});
//# sourceMappingURL=index.min.js.map
